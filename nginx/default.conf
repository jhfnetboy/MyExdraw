server {
  listen 80;

  location / {
    proxy_set_header Host $host;
    proxy_set_header X-Forwarded-Proto $scheme;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_set_header Accept-Encoding "";

    proxy_pass http://excalidraw:80;

    sub_filter_types text/html;
    sub_filter_once on;
    sub_filter "</head>" "<style id=\"myexdraw-ui\">a[href*=\"plus.excalidraw.com\"],a[href*=\"app.excalidraw.com\"],a[href*=\"discord\"],a[href*=\"twitter.com\"],a[href*=\"x.com\"],a[href*=\"portal.excalidraw.com\"]{display:none!important}</style><script id=\"myexdraw-patch\">(()=>{const MYEXDRAW_REPO='https://github.com/jhfnetboy/MyExdraw';const EXCALIDRAW_REPO='https://github.com/excalidraw/excalidraw';const removeIf=(el)=>{if(el&&el.remove){el.remove();return true}return false};const textEq=(el,t)=>((el.textContent||'').trim()===t);const textHas=(el,t)=>((el.textContent||'').includes(t));const patch=()=>{try{const anchors=[...document.querySelectorAll('a[href]')];for(const a of anchors){const href=a.getAttribute('href')||'';if(href.includes('github.com/excalidraw/excalidraw')){if(textHas(a,'Say thanks')){a.setAttribute('href',EXCALIDRAW_REPO);}else{a.setAttribute('href',MYEXDRAW_REPO);}}if(href.includes('github.com/excalidraw/excalidraw/blob')&&href.includes('LICENSE')){a.setAttribute('href',MYEXDRAW_REPO);}}const nodes=[...document.querySelectorAll('a,button,li,div,span')];for(const n of nodes){if(!n.textContent) continue;const t=(n.textContent||'').trim();if(t==='Live collaboration'||t==='Follow us'||t==='Discord'||t==='Sign up'||t==='Signup'){removeIf(n.closest('li')||n.closest('a')||n.closest('button')||n);}if(t==='Excalidraw+'||t==='Excalidraw++'||textHas(n,'Excalidraw+')){const el=n.closest('a')||n.closest('button')||n;el.textContent='Say thanks';if(el.tagName&&el.tagName.toLowerCase()==='a'){el.setAttribute('href',EXCALIDRAW_REPO);el.setAttribute('target','_blank');el.setAttribute('rel','noreferrer noopener');}}}const external=[...document.querySelectorAll('a[href]')].filter(a=>{const u=a.href||'';return u.includes('plus.excalidraw.com')||u.includes('app.excalidraw.com')||u.includes('discord')||u.includes('twitter.com')||u.includes('x.com')||u.includes('portal.excalidraw.com')||u.includes('github.com/excalidraw/excalidraw');});for(const a of external){let el=a;for(let i=0;i<6&&el;i++){const style=window.getComputedStyle(el);if(style&&style.position==='fixed'&&style.right!=='auto'&&style.bottom!=='auto'){removeIf(el);break;}el=el.parentElement;}}}catch(e){}};patch();let n=0;const id=setInterval(()=>{patch();n++;if(n>20)clearInterval(id)},500);})();</script></head>";
  }
}
